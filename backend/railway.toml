[build]
builder = "NIXPACKS"

[build.env]
# Use CPU-only PyTorch to reduce image size
PIP_EXTRA_INDEX_URL = "https://download.pytorch.org/whl/cpu"
# Disable pip cache to save space
PIP_NO_CACHE_DIR = "1"

[deploy]
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/docs"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[deploy.env]
# Python optimizations
PYTHONUNBUFFERED = "1"
PYTHONDONTWRITEBYTECODE = "1"